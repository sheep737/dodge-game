<!DOCTYPE html>
<html lang="ja">

<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>Shared Text</title>
<style>
  body { text-align:center; }
  input, button {
    font-size:5vw;
    padding:10px;
    margin:10px;
  }
  #displayArea {
    margin-top:5vh;
    font-size:7vw;
    color:#0f0;
  }
</style>
</head>

<body>
<div id="roomPanel">
  <input id="roomInput" placeholder="ver:4">
  <button id="joinBtn">Join</button>
</div>

<div id="main" style="display:none;">
  <h2>ã‚ãªãŸã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›</h2>
  <input id="textInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
  <button id="sendBtn">é€ä¿¡</button>

  <h2 style="margin-top:5vh;">ğŸ“¢ å…±æœ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h2>
  <div id="displayArea">(ã¾ã ã‚ã‚Šã¾ã›ã‚“)</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* --- ã‚ãªãŸã® Firebase è¨­å®š --- */
const firebaseConfig = {
    apiKey: "AIzaSyAs8DqxHiRzveAMJ7j-UMBWKp6ztGF-hd8",
    authDomain: "ddgame-6f5f8.firebaseapp.com",
    databaseURL: "https://ddgame-6f5f8-default-rtdb.firebaseio.com",
    projectId: "ddgame-6f5f8",
    storageBucket: "ddgame-6f5f8.firebasestorage.app",
    messagingSenderId: "172945824128",
    appId: "1:172945824128:web:e3c7333928e1545aa1c965",
    measurementId: "G-FG0645HHZD"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

/* UI */
const roomPanel   = document.getElementById("roomPanel");
const main        = document.getElementById("main");
const joinBtn     = document.getElementById("joinBtn");
const roomInput   = document.getElementById("roomInput");

const textInput   = document.getElementById("textInput");
const sendBtn     = document.getElementById("sendBtn");
const displayArea = document.getElementById("displayArea");

let roomId = null;
let textRef = null;

/* Join */
joinBtn.onclick = () => {
  const id = roomInput.value.trim();
  if (!id) {
    alert("Room ID ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  roomId = id;
  textRef = ref(db, `rooms/${roomId}/text`);

  roomPanel.style.display = "none";
  main.style.display = "block";

  /* éƒ¨å±‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å¸¸ã«ç›£è¦–ï¼ˆç›¸æ‰‹ã®å…¥åŠ›ã‚‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ ï¼‰ */
  onValue(textRef, snap => {
    const t = snap.val();
    displayArea.innerText = (t && t.trim()) ? t : "ï¼ˆç©ºã§ã™ï¼‰";
  });
};

/* é€ä¿¡ãƒœã‚¿ãƒ³ï¼šå…¥åŠ›æ–‡å­—ã‚’ Firebase ã«æ›¸ãè¾¼ã‚€ */
sendBtn.onclick = () => {
  const t = textInput.value;

  // ç©ºæ–‡å­—ãªã‚‰ï¼ˆç©ºã§ã™ï¼‰ã¨é€ã‚‹å¿…è¦ã¯ãªã„ â†’ "empty" ã¨ã—ã¦ç©ºæ‰±ã„ã«ã™ã‚‹
  const send = t.trim() ? t : "";

  set(textRef, send);
};
</script>

</body>
</html>
