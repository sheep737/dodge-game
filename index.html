<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Shared Text</title>
  <style> body { text-align:center; } </style>
</head>

<body>
  <div id="roomPanel">
    <input id="roomInput" placeholder="ver:6">
    <button id="joinBtn">Join</button>
  </div>

  <div id="main" style="display:none;">
    <input id="textInput">
    <button id="sendBtn">送信</button>
    <div id="displayArea">(まだありません)</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    
    /* --- あなたの Firebase 設定 --- */
    const firebaseConfig = {
        apiKey: "AIzaSyAs8DqxHiRzveAMJ7j-UMBWKp6ztGF-hd8",
        authDomain: "ddgame-6f5f8.firebaseapp.com",
        databaseURL: "https://ddgame-6f5f8-default-rtdb.firebaseio.com",
        projectId: "ddgame-6f5f8",
        storageBucket: "ddgame-6f5f8.firebasestorage.app",
        messagingSenderId: "172945824128",
        appId: "1:172945824128:web:e3c7333928e1545aa1c965",
        measurementId: "G-FG0645HHZD"
    };
    
    const db  = getDatabase(initializeApp(firebaseConfig));
    
    /* UI */
    const roomPanel   = document.getElementById("roomPanel");
    const main        = document.getElementById("main");
    const joinBtn     = document.getElementById("joinBtn");
    const roomInput   = document.getElementById("roomInput");
    
    const textInput   = document.getElementById("textInput");
    const sendBtn     = document.getElementById("sendBtn");
    const displayArea = document.getElementById("displayArea");
    
    let roomId = null;
    let textRef = null;
    
    /* Join */
    joinBtn.onclick = () => {
      const id = roomInput.value.trim();
    
      roomId = id;
      textRef = ref(db, `rooms/${roomId}/text`);
    
      roomPanel.style.display = "none";
      main.style.display = "block";
    
      /* 部屋のテキストを常に監視（相手の入力もリアルタイム反映） */
      onValue(textRef, snap => {
        const t = snap.val();
        displayArea.innerText = (t && t.trim()) ? t : "（空です）";
      });
    };
    
    /* 送信ボタン：入力文字を Firebase に書き込む */
    sendBtn.onclick = () => {
      const t = textInput.value;
    
      // 空文字なら（空です）と送る必要はない → "empty" として空扱いにする
      const send = t.trim() ? t : "";
    
      set(textRef, send);
    };
  </script>

</body>
</html>
