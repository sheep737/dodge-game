<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <style>
    #box {
      width: 50px;
      height: 50px;
      background: orange;
      margin-top: 20px;
      position: absolute;
    }
  </style>
</head>

<body>
  <div>
    <input id="textInput">
    <button id="sendBtn">ver:20</button>
    <div id="displayArea">(まだありません)</div>
    <div id="box"></div>
  </div>
  
  <!-- script -->
  <script type="module">
    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    
    /* あなたの Firebase 設定 */
    const firebaseConfig = {
        apiKey:            "AIzaSyAs8DqxHiRzveAMJ7j-UMBWKp6ztGF-hd8",
        authDomain:        "ddgame-6f5f8.firebaseapp.com",
        databaseURL:       "https://ddgame-6f5f8-default-rtdb.firebaseio.com",
        projectId:         "ddgame-6f5f8",
        storageBucket:     "ddgame-6f5f8.firebasestorage.app",
        messagingSenderId: "172945824128",
        appId:             "1:172945824128:web:e3c7333928e1545aa1c965",
        measurementId:     "G-FG0645HHZD"
    };
    const db  = getDatabase(initializeApp(firebaseConfig));
    
    /* 要素情報 */
    const box         = document.getElementById("box");
    const textInput   = document.getElementById("textInput");
    const sendBtn     = document.getElementById("sendBtn");
    const displayArea = document.getElementById("displayArea");

    let isDown = false;
    let offsetX = 0;
    let offsetY = 0;

    box.addEventListener("mousedown", (e) => {
      isDown = true;
      offsetX = e.offsetX;
      offsetY = e.offsetY;
    });

    document.addEventListener("mousemove", (e) => {
      if (!isDown) return;
      box.style.left = (e.pageX - offsetX) + "px";
      box.style.top  = (e.pageY - offsetY) + "px";
    });

    document.addEventListener("mouseup", () => {
      isDown = false;
    });
    
    /* テキスト監視（リアルタイム反映） */
    let textRef = ref(db, `rooms/Q/text`);
　  onValue(textRef, snap => {
        const t = snap.val();
        displayArea.innerText = (t && t.trim()) ? t : "（空です）";
    });
        
    /* 送信ボタン：入力文字を Firebase に書き込む */
    sendBtn.onclick = () => {
      set(textRef, textInput.value);
    };
    
  </script>

</body>
</html>
