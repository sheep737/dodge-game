<!DOCTYPE html>
<html lang="ja">

<head>
  <!-- head -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Shared Text</title>
  <style> body { text-align:center; } </style>
</head>

<body>
  <!-- body -->
  <div id="roomPanel">
    <button id="joinBtn">join</button>
  </div>

  <div id="main" style="display:block;">
    <input id="textInput">
    <button id="sendBtn">ver:14</button>
    <div id="displayArea">(まだありません)</div>
  </div>
  
  <!-- script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    
    /* あなたの Firebase 設定 */
    const firebaseConfig = {
        apiKey:            "AIzaSyAs8DqxHiRzveAMJ7j-UMBWKp6ztGF-hd8",
        authDomain:        "ddgame-6f5f8.firebaseapp.com",
        databaseURL:       "https://ddgame-6f5f8-default-rtdb.firebaseio.com",
        projectId:         "ddgame-6f5f8",
        storageBucket:     "ddgame-6f5f8.firebasestorage.app",
        messagingSenderId: "172945824128",
        appId:             "1:172945824128:web:e3c7333928e1545aa1c965",
        measurementId:     "G-FG0645HHZD"
    };
    const db  = getDatabase(initializeApp(firebaseConfig));
    
    /* 要素情報 */
    const roomPanel   = document.getElementById("roomPanel");
    const main        = document.getElementById("main");
    const joinBtn     = document.getElementById("joinBtn");
    
    const textInput   = document.getElementById("textInput");
    const sendBtn     = document.getElementById("sendBtn");
    const displayArea = document.getElementById("displayArea");
    
    let textRef = null;
    
    /* Joinボタン押下 */
    joinBtn.onclick = () => {

      /* テキスト監視（リアルタイム反映） */
      textRef = ref(db, `rooms/Q/text`);
      onValue(textRef, snap => {
        const t = snap.val();
        displayArea.innerText = (t && t.trim()) ? t : "（空です）";
      });
    };
    
    /* 送信ボタン：入力文字を Firebase に書き込む */
    sendBtn.onclick = () => {
      set(textRef, textInput.value);
    };
  </script>

</body>
</html>
